<!-- new_todo.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New ToDo</title>
  </head>
  <body>
    <h1>New ToDo</h1>

    <form id="newTodoForm">
      <label for="userDropdown">Select User:</label>
      <select id="userDropdown" name="userid">
        <!-- Populate options dynamically using JavaScript -->
      </select>

      <label for="categoryDropdown">Select Category:</label>
      <select id="categoryDropdown" name="category">
        <!-- Populate options dynamically using JavaScript -->
      </select>

      <label for="priorityDropdown">Select Priority:</label>
      <select id="priorityDropdown" name="priority">
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
      </select>

      <label for="description">Description:</label>
      <textarea id="description" name="description"></textarea>

      <label for="deadline">Deadline:</label>
      <input type="text" id="deadline" name="deadline" placeholder="YYYY-MM-DD" />

      <!-- Submit button -->
      <button type="button" onclick="addTodo()">Add ToDo</button>
    </form>

    <script>
      // Fetch users and populate the user dropdown
      fetch("http://localhost:8083/api/users")
        .then((response) => response.json())
        .then((users) => {
          const userDropdown = document.getElementById("userDropdown");
          users.forEach((user) => {
            const option = document.createElement("option");
            option.value = user.id;
            option.textContent = user.name;
            userDropdown.appendChild(option);
          });
        });

      // Fetch categories and populate the category dropdown
      fetch("http://localhost:8083/api/categories")
        .then((response) => response.json())
        .then((categories) => {
          const categoryDropdown = document.getElementById("categoryDropdown");
          categories.forEach((category) => {
            const option = document.createElement("option");
            option.value = category.name;
            option.textContent = category.name;
            categoryDropdown.appendChild(option);
          });
        });

      // Function to add a new ToDo task
      function addTodo() {
        const form = document.getElementById("newTodoForm");
        const formData = new FormData(form);

        fetch("http://localhost:8083/api/todos", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("New ToDo added:", data);
          })
          .catch((error) => {
            console.error("Error adding ToDo:", error);
          });
      }
    </script>
  </body>
</html>
